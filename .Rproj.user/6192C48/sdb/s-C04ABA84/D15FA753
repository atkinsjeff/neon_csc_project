{
    "collab_server" : "",
    "contents" : "# 03_fpar_modelling\nrequire(plyr)\nrequire(dplyr)\nrequire(ggplot2)\n\n## renaming dfs to coincide with analysis scripts\n\nmaster.plot <- plot.w.light\nmaster.site <- site.w.light\n\n## coding light regime classification\nmaster.plot$regime <- ifelse(master.plot$aPAR_mean >= 1000, \"high\",\n                             \"low\")\n\nmaster.plot$regime <- as.factor(master.plot$regime)\nhigh2 <- subset(master.plot, aPAR_mean >= 1000)\nlow <- subset(master.plot, aPAR_mean < 1000)\n\n# custom plot theme\ntheme_new <- function(base_size = 12){\n  theme_bw(base_size = base_size) %+replace%\n    theme(\n      #line = element_line(colour=\"black\"),\n      #text = element_text(colour=\"black\"),\n      #axis.text = element_text(colour=\"black\", size=8),\n      #strip.text = element_text(size=12),\n      legend.key=element_rect(colour=NA, fill =NA),\n      panel.grid = element_blank(),   \n      panel.border = element_blank(),\n      panel.background = element_rect(fill = \"white\", colour = \"white\"), \n      strip.background = element_rect(fill = NA),\n      axis.text = element_text( size = 14),\n      axis.title  = element_text( size = 16, margin = margin(12, unit = \"cm\")),\n      legend.title=element_blank()\n    )\n  \n}\n\n# custom plot label\n\nvai.label =  expression(paste(VAI~(m^2 ~m^-2)))\nlai.label =  expression(paste(LAI~(m^2 ~m^-2)))\nlog.lai.label = expression(paste(log~( LAI~(m^2 ~m^-2))))\n\n\n\n\n### Making functions\n\n##### RUGOSITY\n\n# Direct Light modeling for HIGH light\n# model should be fPAR = a * x / (b + x) ...Michaelis-Menten\ny <- high$fPAR_mean\nx <- high$rugosity_mean\n\n# 1\nm.rugosity <- nls(y ~ a / (1 + (b * exp(-k * x))), start = list(a = 1, b = 1, k = 1))\nm.rugosity <- nls(y ~ a / (1 + b * exp(-k * x)), start = list(a = 0.08, b = -0.9, k = 0.01) )\nsummary(m.rugosity)\n\n\nRSS <- sum(residuals(m.rugosity)^2)\nTSS <- sum((y - mean(y))^2)\nR.square <- 1 - (RSS/TSS)\nprint(R.square)\nAIC(m.rugosity)\n\n# plot w/ coefficents\nx11()\nplot(x, y, xlab = \"Canopy Rugosity (m)\", ylab = \"fPAR\")\na <- coef(m.rugosity)[1]\nb <- coef(m.rugosity)[2]\nk <- coef(m.rugosity)[3]\ncurve( (a / (1 + (b * exp(-k * x)))), col = \"blue\", add = TRUE)\n\n##### Top Rugosity\n# 2\nm.top <- nls(y ~ a * (x^b), start = list(a = 1, b = 1))\n\nsummary(m.top)\n\n\nRSS <- sum(residuals(m.rugosity2)^2)\nTSS <- sum((y - mean(y))^2)\nR.square <- 1 - (RSS/TSS)\nprint(R.square)\n\n# plot w/ coefficents\nx11()\nplot(x, y, xlab = \"Canopy Rugosity (m)\", ylab = \"fPAR\")\na <- coef(m.direct)[1]\nb <- coef(m.direct)[2]\ncurve(a + (b * x) / (c + x), col = \"blue\", add = TRUE)\n### LOW LIGHT\ny <- low$fPAR_mean\nx <- low$rugosity_mean\nm.low <- nls(y ~ (a * x) / (b + x), start = list(a = 1, b = 1))\n\nx11()\nplot(x, y, xlab = \"Canopy Rugosity (m)\", ylab = \"fPAR\")\na <- coef(m.direct)[1]\nb <- coef(m.direct)[2]\ncurve((a * x) / (b + x), col = \"blue\", add = TRUE)\n\n\nRSS <- sum(residuals(m.low)^2)\nTSS <- sum((y - mean(y))^2)\nR.square <- 1 - (RSS/TSS)\nprint(R.square)\n\nfpar.high <- function(x) {(1.075147 * x) / ( 3.085004+ x)}\nfpar.low <- function(x) {(0.89777 * low$rugosity_mean) / ( 1.16947 + low$rugosity_mean)}\n\nx11(width = 5, height = 5)\nggplot(high, aes(x = rugosity_mean, y = fPAR_mean))+\n  geom_point(size = 4, shape = 21)+\n  theme_new()+\n  xlab(r.label)+\n  ylab(\"fPAR\")+\n  stat_function(fun = fpar.high, col = \"blue\", size = 1)+\n  geom_point(data = low, aes(x = rugosity_mean, y = fPAR_mean), size = 4, color = \"black\")+\n  stat_function(fun = function(x) (0.89777 * low$rugosity_mean) / ( 1.16947 + low$rugosity_mean), col = \"red\")\n\n#### VAI\ny <- high$fPAR_mean\nx <- high$mean.vai_mean\n\n\nm.vai <- lm(y ~ x)\nsummary(m.vai)\n\n\nRSS <- sum(residuals(m.direct)^2)\nTSS <- sum((y - mean(y))^2)\nR.square <- 1 - (RSS/TSS)\nprint(R.square)\n\nx11()\nggplot(aes(x = x, y = y))+\n  geom_point(size = 2, shape = 21)+\n  theme_classic()+\n  xlab(\"Rugosity (m)\")+\n  ylab(\"fPAR\")+\n  geom_smooth(method = \"lm\")\n\n\n##### MEAN VAI\n\n# Direct Light modeling for HIGH light\n# model should be fPAR = a * x / (b + x) ...Michaelis-Menten\ny <- high$fPAR_mean\nx <- high$mean.vai_mean\n\n\nm.vai.high <- lm(y ~ x)\nsummary(m.vai.high)\n\n\nx11(width = 5, height = 5)\nggplot(high, aes(x = mean.vai_mean, y = fPAR_mean))+\n  geom_point(size = 4, shape = 21)+\n  theme_new()+\n  xlab(vai.label)+\n  ylab(\"fPAR\")+\n  geom_smooth(method = \"lm\", col = \"red\", size = 1, se = FALSE)\n\nx11()\nplot(log(high$rugosity_mean), resid(m.vai.high))\n\nsummary(lm(resid(m.vai.high) ~ log(high$rugosity_mean)))\n# x11()\n# ggplot(master.site, aes(x = rugosity_mean, y = fPAR,  color = site))+\n#      geom_point(size = 5)+\n#      #geom_text()+\n#      #scale_color_manual(values=cbPalette)+\n#      #scale_color_brewer(palette=\"Dark2\")+\n#      geom_errorbarh(aes(xmin =rugosity_mean - rugosity_sd, xmax = rugosity_mean + rugosity_sd)) + \n#      #geom_errorbar(aes(ymin = fPAR_mean - fPAR_sd, ymax = fPAR_mean + fPAR_sd))+\n#      theme_new()+\n#      ylab(\"fPAR \")+\n#      xlab(\"Rugosity (m)\")+\n#      stat_function(fun = function(x) (0.97624 * x) / (1.74132 + x), colour = \"dark grey\", size = 1.25)\n\n\n### RUMPLE\n##### RUGOSITY\n\n# Direct Light modeling for HIGH light\n# model should be fPAR = a * x / (b + x) ...Michaelis-Menten\ny <- low$fPAR_mean\nx <- low$rugosity_mean\n\n\nm.light <- nls(y ~ (a * x) / (b + x), start = list(a = 1, b = 1))\nsummary(m.light)\n\n\nRSS <- sum(residuals(m.light)^2)\nTSS <- sum((y - mean(y))^2)\nR.square <- 1 - (RSS/TSS)\nprint(R.square)\n\n\nfpar.rump <- function(x) {(2.3478 * x) / ( 10.4647 + x)}\nfpar.low <- function(x) {(0.89777 * low$rugosity_mean) / ( 1.16947 + low$rugosity_mean)}\n\nx11(width = 5, height = 5)\nggplot(high, aes(x = rugosity_mean, y = fPAR_mean))+\n  geom_point(size = 4, shape = 21)+\n  theme_new()+\n  xlab(r.label)+\n  ylab(\"fPAR\")+\n  stat_function(fun = fpar.high, col = \"blue\", size = 1)+\n  geom_point(data = low, aes(x = rugosity_mean, y = fPAR_mean), size = 4, color = \"black\")+\n  stat_function(fun = function(x) (0.89777 * low$rugosity_mean) / ( 1.16947 + low$rugosity_mean), col = \"red\")\n\n\nm.multi <- lm(fPAR_mean ~ mean.vai_mean * rugosity_mean * rumple_mean, data = master.site)\n\n\n####\n####\nm.vai <- lm(rugosity_mean ~ mean.vai_mean, data = high)\nx11(width = 5, height = 5)\nggplot(master.plot, aes(x = rugosity_mean, y = fPAR_mean, color = regime ))+\n  geom_point(size = 4, shape = 21)+\n  theme_new()+\n  xlab(r.label)+\n  ylab(\"fPAR\")\n",
    "created" : 1515098331337.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "19|38|36|0|\n",
    "hash" : "1723103945",
    "id" : "D15FA753",
    "lastKnownWriteTime" : 1515698625,
    "last_content_update" : 1515698625656,
    "path" : "C:/github/neon_csc_project/02_fpar_csc_modeling.R",
    "project_path" : "02_fpar_csc_modeling.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : true,
    "source_window" : "",
    "type" : "r_source"
}